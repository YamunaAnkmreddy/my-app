{% extends 'base.html' %}

{% block title %}{{ quiz.title }} - Quiz Platform{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <!-- Quiz Header -->
            <div class="card shadow mb-4">
                <div class="card-header bg-primary text-white">
                    <h2 class="mb-0">
                        <i class="fas fa-quiz"></i> {{ quiz.title }}
                    </h2>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h5><i class="fas fa-info-circle text-primary"></i> Quiz Information</h5>
                            <ul class="list-unstyled">
                                <li><strong>Category:</strong> {{ quiz.category.name }}</li>
                                {% if quiz.subcategory %}
                                    <li><strong>Subcategory:</strong> {{ quiz.subcategory.name }}</li>
                                {% endif %}
                                <li><strong>Difficulty:</strong> 
                                    <span class="badge bg-{% if quiz.difficulty == 'easy' %}success{% elif quiz.difficulty == 'medium' %}warning{% else %}danger{% endif %}">
                                        {{ quiz.difficulty|title }}
                                    </span>
                                </li>
                                <li><strong>Questions:</strong> {{ questions_count }}</li>
                                <li><strong>Time Limit:</strong> {{ quiz.time_limit }} minutes</li>
                                {% if quiz.is_ai_generated %}
                                    <li><strong>Generated by:</strong> <i class="fas fa-robot text-primary"></i> AI</li>
                                {% endif %}
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h5><i class="fas fa-chart-bar text-success"></i> Quiz Stats</h5>
                            <div class="text-center">
                                <div class="row">
                                    <div class="col-4">
                                        <div class="p-2 bg-light rounded">
                                            <h4 class="text-primary">{{ questions_count }}</h4>
                                            <small>Questions</small>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="p-2 bg-light rounded">
                                            <h4 class="text-warning">{{ quiz.time_limit }}</h4>
                                            <small>Minutes</small>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="p-2 bg-light rounded">
                                            <h4 class="text-info">
                                                {% widthratio quiz.time_limit questions_count 1 %}
                                            </h4>
                                            <small>Min/Q</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    {% if quiz.description %}
                        <div class="mt-3">
                            <h5><i class="fas fa-file-text text-muted"></i> Description</h5>
                            <p class="text-muted">{{ quiz.description }}</p>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Previous Attempt (if any) -->
            {% if existing_attempt %}
                <div class="alert alert-info">
                    <h5><i class="fas fa-history"></i> Previous Attempt</h5>
                    <p class="mb-2">You've already taken this quiz!</p>
                    <div class="row">
                        <div class="col-md-6">
                            <strong>Score:</strong> {{ existing_attempt.score }}/{{ existing_attempt.total_questions }} 
                            ({{ existing_attempt.get_percentage }}%)
                        </div>
                        <div class="col-md-6">
                            <strong>Grade:</strong> 
                            <span class="badge bg-{% if existing_attempt.get_percentage >= 80 %}success{% elif existing_attempt.get_percentage >= 60 %}warning{% else %}danger{% endif %}">
                                {{ existing_attempt.get_grade }}
                            </span>
                        </div>
                    </div>
                    <div class="mt-2">
                        <a href="{% url 'quiz_result' existing_attempt.id %}" class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-eye"></i> View Results
                        </a>
                    </div>
                </div>
            {% endif %}

            <!-- Instructions -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5><i class="fas fa-list-check"></i> Instructions</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Before You Start:</h6>
                            <ul class="text-muted">
                                <li>Make sure you have a stable internet connection</li>
                                <li>Find a quiet place to focus</li>
                                <li>You have {{ quiz.time_limit }} minutes to complete</li>
                                <li>All questions are multiple choice</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6>During the Quiz:</h6>
                            <ul class="text-muted">
                                <li>Read each question carefully</li>
                                <li>You can navigate between questions</li>
                                <li>Your answers are saved automatically</li>
                                <li>Submit when you're done or time runs out</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Start Quiz Button -->
            <div class="text-center">
                {% if user.is_authenticated %}
                    <a href="{% url 'start_quiz' quiz.id %}" class="btn btn-success btn-lg" id="start-quiz-btn">
                        <i class="fas fa-play"></i> 
                        {% if existing_attempt %}Retake Quiz{% else %}Start Quiz{% endif %}
                    </a>
                    <div class="mt-2">
                        <small class="text-muted">
                            <i class="fas fa-info-circle"></i> 
                            Click to begin your {{ quiz.time_limit }}-minute quiz session
                        </small>
                    </div>
                {% else %}
                    <p class="text-muted">Please <a href="{% url 'login' %}">login</a> to take this quiz.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const startBtn = document.getElementById('start-quiz-btn');
    
    if (startBtn) {
        startBtn.addEventListener('click', function(e) {
            if (!confirm('Are you ready to start the quiz? The timer will begin immediately!')) {
                e.preventDefault();
            }
        });
    }
});
</script>
{% endblock %}