{% extends 'base.html' %}

{% block title %}Leaderboard - Quiz Platform{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row">
        <div class="col-12">
            <div class="text-center mb-5">
                <h1><i class="fas fa-crown text-warning"></i> Global Leaderboard</h1>
                <p class="lead text-muted">Top performers across all categories</p>
            </div>

            <!-- Your Rank (if logged in) -->
            {% if user.is_authenticated and user_rank %}
                <div class="alert alert-info mb-4">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h5><i class="fas fa-user"></i> Your Current Rank</h5>
                            <p class="mb-0">You are ranked <strong>#{{ user_rank }}</strong> with an average score of <strong>{{ user.userprofile.average_score|floatformat:1 }}%</strong></p>
                        </div>
                        <div class="col-md-4 text-end">
                            <a href="{% url 'quiz_categories' %}" class="btn btn-primary">
                                <i class="fas fa-arrow-up"></i> Improve Rank
                            </a>
                        </div>
                    </div>
                </div>
            {% endif %}

            <!-- Top 3 Podium -->
            {% if top_users %}
                <div class="row mb-5">
                    {% for profile in top_users|slice:":3" %}
                        <div class="col-md-4 text-center mb-4">
                            <div class="card h-100 {% if forloop.counter == 1 %}border-warning{% elif forloop.counter == 2 %}border-secondary{% else %}border-danger{% endif %}">
                                <div class="card-body">
                                    <!-- Trophy Icon -->
                                    <div class="mb-3">
                                        <i class="fas fa-trophy fa-4x text-{% if forloop.counter == 1 %}warning{% elif forloop.counter == 2 %}secondary{% else %}danger{% endif %}"></i>
                                    </div>
                                    
                                    <!-- Rank -->
                                    <h2 class="text-{% if forloop.counter == 1 %}warning{% elif forloop.counter == 2 %}secondary{% else %}danger{% endif %}">
                                        #{{ forloop.counter }}
                                    </h2>
                                    
                                    <!-- User Info -->
                                    <h4 {% if profile.user == user %}class="text-primary"{% endif %}>
                                        {{ profile.user.first_name|default:profile.user.username }}
                                        {% if profile.user == user %}<small>(You)</small>{% endif %}
                                    </h4>
                                    
                                    <!-- Stats -->
                                    <div class="mt-3">
                                        <div class="row">
                                            <div class="col-6">
                                                <div class="p-2 bg-light rounded">
                                                    <h5 class="mb-0">{{ profile.average_score|floatformat:1 }}%</h5>
                                                    <small class="text-muted">Avg Score</small>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="p-2 bg-light rounded">
                                                    <h5 class="mb-0">{{ profile.total_quizzes }}</h5>
                                                    <small class="text-muted">Quizzes</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}

            <!-- Complete Leaderboard -->
            <div class="card">
                <div class="card-{% endblock %}